<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Meelo | onBoarding</title>
  </head>
  <body>
    <main class="mobile-frame">
      <div class="mobile-container">
        <div class="mobile-notch"></div>
        <div id="psychological-test" style="height: calc(100% - 83px)">
          <div
            class="mobile-content h-100 pt-6t d-flex flex-column overflow-hidden"
          >
            <div class="container">
              <div id="rating-root" data-progress="14.29"></div>
            </div>
            <!-- gender-start -->
            <section
              class="gender-content container position-sticky z-2 page-scoll-mask-t"
            >
              <h1 class="mt-6t mb-2 fs-3 fw-bold text-primary-default">Elly</h1>
              <h2 class="mb-0 fs-4 fw-bold text-text-primary">你的性別是...</h2>
            </section>
            <section
              class="gender-content container option-contain flex-grow-1 mb-16t"
            >
              <form id="genderForm" class="optionLayout row g-4t">
                <div class="col-6">
                  <div class="onboarding-check rounded-4">
                    <input
                      class="onboarding-check-input d-none"
                      type="radio"
                      name="gender"
                      id="female"
                      value="female"
                    />
                    <label
                      class="onboarding-check-label card h-100"
                      for="female"
                    >
                      <div class="card-body">
                        <h3 class="onboarding-check-title fs-18 fw-bold">
                          女性
                        </h3>
                        <img
                          class="onboarding-gender-img position-absolute z-1"
                          src="/assets/images/onboarding/gender-1.png"
                          alt="性別選項-女性"
                        />
                      </div>
                    </label>
                  </div>
                </div>
                <div class="col-6">
                  <div class="onboarding-check rounded-4">
                    <input
                      class="onboarding-check-input d-none"
                      type="radio"
                      name="gender"
                      id="male"
                      value="male"
                    />
                    <label class="onboarding-check-label card h-100" for="male">
                      <div class="card-body">
                        <h3 class="onboarding-check-title fs-18 fw-bold">
                          男性
                        </h3>
                        <img
                          class="onboarding-gender-img position-absolute z-1"
                          src="/assets/images/onboarding/gender-2.png"
                          alt="性別選項-男性"
                        />
                      </div>
                    </label>
                  </div>
                </div>
                <div class="col-6">
                  <div class="onboarding-check rounded-4">
                    <input
                      class="onboarding-check-input d-none"
                      type="radio"
                      name="gender"
                      id=" bigender"
                      value="bigender"
                    />
                    <label
                      class="onboarding-check-label card h-100"
                      for=" bigender"
                    >
                      <div class="card-body">
                        <h3 class="onboarding-check-title fs-18 fw-bold">
                          雙性別
                        </h3>
                        <img
                          class="onboarding-gender-img position-absolute z-1"
                          src="/assets/images/onboarding/gender-3.png"
                          alt="性別選項-雙性別"
                        />
                      </div>
                    </label>
                  </div>
                </div>
                <div class="col-6">
                  <div class="onboarding-check rounded-4">
                    <input
                      class="onboarding-check-input d-none"
                      type="radio"
                      name="gender"
                      id="agender"
                      value="agender"
                    />
                    <label
                      class="onboarding-check-label card h-100"
                      for="agender"
                    >
                      <div class="card-body">
                        <h3 class="onboarding-check-title fs-18 fw-bold">
                          無性別
                        </h3>
                        <img
                          class="onboarding-gender-img position-absolute z-1"
                          src="/assets/images/onboarding/gender-1.png"
                          alt="性別選項-無性別"
                        />
                      </div>
                    </label>
                  </div>
                </div>
                <div class="col-6">
                  <div class="onboarding-check rounded-4">
                    <input
                      class="onboarding-check-input d-none"
                      type="radio"
                      name="gender"
                      id="disclose"
                      value="disclose"
                    />
                    <label
                      class="onboarding-check-label card h-100"
                      for="disclose"
                    >
                      <div class="card-body">
                        <h3 class="onboarding-check-title fs-18 fw-bold">
                          不願透露
                        </h3>
                        <img
                          class="onboarding-gender-img position-absolute z-1"
                          src="/assets/images/onboarding/gender-5.png"
                          alt="性別選項-不願透露"
                        />
                      </div>
                    </label>
                  </div>
                </div>
              </form>
            </section>
            <!-- gender-end -->
            <!-- interest-start -->
            <section
              class="form-fade-default interest-content container position-sticky z-2 page-scoll-mask-t"
            >
              <h1 class="mt-6t mb-2 fs-4 fw-bold text-text-primary">
                你的興趣是...
              </h1>
              <p class="mb-0 fs-14 text-black text-opacity-60">最多選三項</p>
            </section>
            <section
              class="form-fade-default interest-content container option-contain"
            >
              <form id="interestForm" class="optionLayout row g-4t pb-16t">
                <div class="col-6">
                  <div class="onboarding-check onboarding-check-lg rounded-4">
                    <input
                      class="onboarding-check-input d-none"
                      type="checkbox"
                      name="interest"
                      id="travel"
                      value="travel"
                    />
                    <label
                      class="onboarding-check-label card h-100"
                      for="travel"
                    >
                      <div class="card-body">
                        <h3 class="fs-18 fw-bold">旅行</h3>
                        <p class="onboarding-check-text fs-14">探索世界各地</p>
                        <img
                          class="onboarding-interest-img position-absolute z-1"
                          src="/assets/images/onboarding/interest-1.png"
                          alt="興趣選項-旅行"
                        />
                      </div>
                    </label>
                  </div>
                </div>
                <div class="col-6">
                  <div class="onboarding-check onboarding-check-lg rounded-4">
                    <input
                      class="onboarding-check-input d-none"
                      type="checkbox"
                      name="interest"
                      id="foodie"
                      value="foodie"
                    />
                    <label
                      class="onboarding-check-label card h-100"
                      for="foodie"
                    >
                      <div class="card-body">
                        <h3 class="fs-18 fw-bold">美食</h3>
                        <p class="onboarding-check-text fs-14">挖掘各地美味</p>
                        <img
                          class="onboarding-interest-img position-absolute z-1"
                          src="/assets/images/onboarding/interest-2.png"
                          alt="興趣選項-美食"
                        />
                      </div>
                    </label>
                  </div>
                </div>
                <div class="col-6">
                  <div class="onboarding-check onboarding-check-lg rounded-4">
                    <input
                      class="onboarding-check-input d-none"
                      type="checkbox"
                      name="interest"
                      id="photograph"
                      value="photograph"
                    />
                    <label
                      class="onboarding-check-label card h-100"
                      for="photograph"
                    >
                      <div class="card-body">
                        <h3 class="fs-18 fw-bold">攝影</h3>
                        <p class="onboarding-check-text fs-14">捕捉精彩瞬間</p>
                        <img
                          class="onboarding-interest-img position-absolute z-1"
                          src="/assets/images/onboarding/interest-3.png"
                          alt="興趣選項-攝影"
                        />
                      </div>
                    </label>
                  </div>
                </div>
                <div class="col-6">
                  <div class="onboarding-check onboarding-check-lg rounded-4">
                    <input
                      class="onboarding-check-input d-none"
                      type="checkbox"
                      name="interest"
                      id="exercise"
                      value="exercise"
                    />
                    <label
                      class="onboarding-check-label card h-100"
                      for="exercise"
                    >
                      <div class="card-body">
                        <h3 class="fs-18 fw-bold">運動</h3>
                        <p class="onboarding-check-text fs-14">
                          一起熱血揮灑汗水
                        </p>
                        <img
                          class="onboarding-interest-img position-absolute z-1"
                          src="/assets/images/onboarding/interest-4.png"
                          alt="興趣選項-運動"
                        />
                      </div>
                    </label>
                  </div>
                </div>
                <div class="col-6">
                  <div class="onboarding-check onboarding-check-lg rounded-4">
                    <input
                      class="onboarding-check-input d-none"
                      type="checkbox"
                      name="interest"
                      id="music"
                      value="music"
                    />
                    <label
                      class="onboarding-check-label card h-100"
                      for="music"
                    >
                      <div class="card-body">
                        <h3 class="fs-18 fw-bold">音樂</h3>
                        <p class="onboarding-check-text fs-14">
                          旋律裡找到自己
                        </p>
                        <img
                          class="onboarding-interest-img position-absolute z-1"
                          src="/assets/images/onboarding/interest-5.png"
                          alt="興趣選項-音樂"
                        />
                      </div>
                    </label>
                  </div>
                </div>
                <div class="col-6">
                  <div class="onboarding-check onboarding-check-lg rounded-4">
                    <input
                      class="onboarding-check-input d-none"
                      type="checkbox"
                      name="interest"
                      id="films-television"
                      value="films-television"
                    />
                    <label
                      class="onboarding-check-label card h-100"
                      for="films-television"
                    >
                      <div class="card-body">
                        <h3 class="fs-18 fw-bold">影視</h3>
                        <p class="onboarding-check-text fs-14">追劇好片推薦</p>
                        <img
                          class="onboarding-interest-img position-absolute z-1"
                          src="/assets/images/onboarding/interest-6.png"
                          alt="興趣選項-影視"
                        />
                      </div>
                    </label>
                  </div>
                </div>
                <div class="col-6">
                  <div class="onboarding-check onboarding-check-lg rounded-4">
                    <input
                      class="onboarding-check-input d-none"
                      type="checkbox"
                      name="interest"
                      id="read"
                      value="read"
                    />
                    <label class="onboarding-check-label card h-100" for="read">
                      <div class="card-body">
                        <h3 class="fs-18 fw-bold">閱讀</h3>
                        <p class="onboarding-check-text fs-14">
                          在字裡尋找世界
                        </p>
                        <img
                          class="onboarding-interest-img position-absolute z-1"
                          src="/assets/images/onboarding/interest-7.png"
                          alt="興趣選項-閱讀"
                        />
                      </div>
                    </label>
                  </div>
                </div>
                <div class="col-6">
                  <div class="onboarding-check onboarding-check-lg rounded-4">
                    <input
                      class="onboarding-check-input d-none"
                      type="checkbox"
                      name="interest"
                      id="learning"
                      value="learning"
                    />
                    <label
                      class="onboarding-check-label card h-100"
                      for="learning"
                    >
                      <div class="card-body">
                        <h3 class="fs-18 fw-bold">學習</h3>
                        <p class="onboarding-check-text fs-14">
                          點亮未知的旅程
                        </p>
                        <img
                          class="onboarding-interest-img position-absolute z-1"
                          src="/assets/images/onboarding/interest-8.png"
                          alt="興趣選項-學習"
                        />
                      </div>
                    </label>
                  </div>
                </div>
                <div class="col-6">
                  <div class="onboarding-check onboarding-check-lg rounded-4">
                    <input
                      class="onboarding-check-input d-none"
                      type="checkbox"
                      name="interest"
                      id="video-games"
                      value="video-games"
                    />
                    <label
                      class="onboarding-check-label card h-100"
                      for="video-games"
                    >
                      <div class="card-body">
                        <h3 class="fs-18 fw-bold">遊戲</h3>
                        <p class="onboarding-check-text fs-14">
                          享受每場冒險樂趣
                        </p>
                        <img
                          class="onboarding-interest-img position-absolute z-1"
                          src="/assets/images/onboarding/interest-9.png"
                          alt="興趣選項-遊戲"
                        />
                      </div>
                    </label>
                  </div>
                </div>
                <div class="col-6">
                  <div class="onboarding-check onboarding-check-lg rounded-4">
                    <input
                      class="onboarding-check-input d-none"
                      type="checkbox"
                      name="interest"
                      id="outdoor-activities"
                      value="outdoor-activities"
                    />
                    <label
                      class="onboarding-check-label card h-100"
                      for="outdoor-activities"
                    >
                      <div class="card-body">
                        <h3 class="fs-18 fw-bold">戶外活動</h3>
                        <p class="onboarding-check-text fs-14">探索世界各地</p>
                        <img
                          class="onboarding-interest-img position-absolute z-1"
                          src="/assets/images/onboarding/interest-10.png"
                          alt="興趣選項-戶外活動"
                        />
                      </div>
                    </label>
                  </div>
                </div>
              </form>
            </section>
            <!-- interest-end -->
            <!-- dietary-start -->
            <section
              class="form-fade-default dietary-content container position-sticky z-2 page-scoll-mask-t"
            >
              <h1 class="py-6t mb-0 fs-4 fw-bold text-text-primary">
                喜歡的美食是...
              </h1>
            </section>
            <section
              class="form-fade-default dietary-content container option-contain flex-grow-1 mb-16t pt-0"
            >
              <form id="dietaryForm" class="dietaryLayout g-4t h-100">
                <div class="onboarding-check onboarding-check-full rounded-4">
                  <input
                    class="onboarding-check-input d-none"
                    type="radio"
                    name="dietary"
                    id="local"
                    value="local"
                  />
                  <label class="onboarding-check-label card h-100" for="local">
                    <div class="card-body d-flex align-items-center">
                      <img
                        class="onboarding-dietary-img position-absolute z-1 position-absolute top-50 translate-middle"
                        src="/assets/images/onboarding/dietary-1.png"
                        alt="美食選項-在地靈魂派"
                      />
                      <div class="ps-6t ms-16t">
                        <h2 class="onboarding-check-title fs-18 fw-bold">
                          在地靈魂派
                        </h2>
                        <p class="onboarding-check-text mb-0 fs-14">
                          鹽酥雞、牛肉麵、蚵仔煎不能少，夜市是我第二個家
                        </p>
                      </div>
                    </div>
                  </label>
                </div>
                <div class="onboarding-check onboarding-check-full rounded-4">
                  <input
                    class="onboarding-check-input d-none"
                    type="radio"
                    name="dietary"
                    id="exotic"
                    value="exotic"
                  />
                  <label class="onboarding-check-label card h-100" for="exotic">
                    <div class="card-body d-flex align-items-center">
                      <img
                        class="onboarding-dietary-img position-absolute z-1 position-absolute top-50 translate-middle"
                        src="/assets/images/onboarding/dietary-2.png"
                        alt="美食選項-異國冒險家"
                      />
                      <div class="ps-6t ms-16t">
                        <h2 class="onboarding-check-title fs-18 fw-bold">
                          異國冒險家
                        </h2>
                        <p class="onboarding-check-text mb-0 fs-14">
                          韓式炸雞、泰式綠咖哩通通愛，胃口沒有國界
                        </p>
                      </div>
                    </div>
                  </label>
                </div>
                <div class="onboarding-check onboarding-check-full rounded-4">
                  <input
                    class="onboarding-check-input d-none"
                    type="radio"
                    name="dietary"
                    id="ritual"
                    value="ritual"
                  />
                  <label class="onboarding-check-label card h-100" for="ritual">
                    <div class="card-body d-flex align-items-center">
                      <img
                        class="onboarding-dietary-img position-absolute z-1 position-absolute top-50 translate-middle"
                        src="/assets/images/onboarding/dietary-3.png"
                        alt="美食選項-儀式感食客"
                      />
                      <div class="ps-6t ms-16t">
                        <h2 class="onboarding-check-title fs-18 fw-bold">
                          儀式感食客
                        </h2>
                        <p class="onboarding-check-text mb-0 fs-14">
                          喜歡擺盤漂亮，有氛圍的早午餐或甜點店
                        </p>
                      </div>
                    </div>
                  </label>
                </div>
                <div class="onboarding-check onboarding-check-full rounded-4">
                  <input
                    class="onboarding-check-input d-none"
                    type="radio"
                    name="dietary"
                    id="experimentalist"
                    value="experimentalist"
                  />
                  <label
                    class="onboarding-check-label card h-100"
                    for="experimentalist"
                  >
                    <div class="card-body d-flex align-items-center">
                      <img
                        class="onboarding-dietary-img position-absolute z-1 position-absolute top-50 translate-middle"
                        src="/assets/images/onboarding/dietary-4.png"
                        alt="美食選項-料理實驗家"
                      />
                      <div class="ps-6t ms-16t">
                        <h2 class="onboarding-check-title fs-18 fw-bold">
                          料理實驗家
                        </h2>
                        <p class="onboarding-check-text mb-0 fs-14">
                          自己動手做最過癮，不只是吃，還要享受料理的樂趣
                        </p>
                      </div>
                    </div>
                  </label>
                </div>
              </form>
            </section>

            <!-- dietary-end -->
            <div
              id="rating-footer"
              data-prev="name"
              data-next="interest"
              data-is-disable="false"
            ></div>
          </div>
        </div>
        <!-- holo-strart -->
        <div class="halo halo-1"></div>
        <div class="halo halo-2"></div>
        <div class="halo halo-3"></div>
        <div class="halo halo-4"></div>
        <!-- holo-end -->
        <!-- character-creating-start -->
        <div id="character-creating" class="d-none h-100">
          <div class="mobile-content position-relative d-none">
            <p
              class="position-absolute z-1 character-creating-text text-center w-100 fw-bold fs-5 lh-sm"
            >
              你點亮的答案如訊息光點，<br />
              正在拼湊出屬於你的角色輪廓...
            </p>
            <video
              class="character-creating"
              src="/assets/images/onboarding/character-creating.mp4"
              autoplay
              loop
              muted
              playsinline
            ></video>
          </div>
        </div>
        <!-- character-creating-end -->
      </div>
    </main>
    <script type="module" src="../../main.js"></script>
    <script type="module" src="../../layout/onboarding/boot-react.jsx"></script>
    <script type="module">
      // gender 表單專用
      const genderSessionStorage = sessionStorage.getItem("gender");
      const genderForm = document.querySelector("#genderForm");
      const radios = genderForm.querySelectorAll('input[name="gender"]');
      let isGenderSelected = genderSessionStorage ? true : false;

      // interest 表單專用
      const interestSessionStorage = sessionStorage.getItem("interest");
      const interestForm = document.querySelector("#interestForm");
      const checkboxs = [
        ...interestForm.querySelectorAll('input[name="interest"]'),
      ];
      const selectedOptions = interestSessionStorage
        ? [...JSON.parse(interestSessionStorage)]
        : [];

      const toggleOption = (event) => {
        const { value, checked } = event.target;

        // 移除選項
        if (!checked) {
          const optionIndex = selectedOptions.findIndex(
            (option) => option === value
          );
          selectedOptions.splice(optionIndex, 1);
          if (selectedOptions.length < 3) {
            checkboxs.forEach((e) => {
              e.removeAttribute("disabled");
            });
          }
          // 新增選項
        } else {
          selectedOptions.push(value);
        }

        sessionStorage.setItem("interest", JSON.stringify(selectedOptions));
      };

      // dietary 專用
      const dietarySessionStorage = sessionStorage.getItem("dietary");
      const dietaryForm = document.querySelector("#dietaryForm");
      const dietaryRadios = dietaryForm.querySelectorAll(
        'input[name="dietary"]'
      );
      let isDietarySelected = dietarySessionStorage ? true : false;

      // 元件
      const ratingEl = document.getElementById("rating-root");
      const ratingFooterEl = document.getElementById("rating-footer");

      // onMounted
      const formContent = document.querySelectorAll(".gender-content");
      formContent.forEach((r) => {
        r.classList.add("form-fade-in");
      });

      ratingFooterEl.dataset.isDisable = isGenderSelected;
      radios.forEach((r) => {
        if (r.value === genderSessionStorage) r.setAttribute("checked", "");
      });

      selectedOptions.forEach((option) => {
        const target = checkboxs.find((checkbox) => checkbox.value === option);
        target.checked = true;
      });
      if (selectedOptions.length >= 3) {
        checkboxs.forEach((e) => {
          if (!e.checked) {
            e.setAttribute("disabled", "");
          }
        });
      }

      dietaryRadios.forEach((r) => {
        if (r.value === dietarySessionStorage) r.setAttribute("checked", "");
      });

      // watch
      genderForm.addEventListener("change", (e) => {
        isGenderSelected = e.target.value ? true : false;
        sessionStorage.setItem("gender", e.target.value);
        ratingFooterEl.dataset.isDisable = isGenderSelected;
      });

      interestForm.addEventListener("change", (e) => {
        // 限制數量
        if (selectedOptions.length >= 2) {
          checkboxs.forEach((e) => {
            if (!e.checked) {
              e.setAttribute("disabled", "");
            }
          });
        }
        toggleOption(e);
        ratingFooterEl.dataset.isDisable = !!selectedOptions.length;
      });

      dietaryForm.addEventListener("change", (e) => {
        isDietarySelected = e.target.value ? true : false;
        sessionStorage.setItem("dietary", e.target.value);
        ratingFooterEl.dataset.isDisable = isGenderSelected;
      });
      // 元件狀態表
      const stateMap = {
        gender: {
          progress: 14.29,
          prev: "name",
          next: "interest",
        },
        interest: {
          progress: 42.86,
          prev: "gender",
          next: "dietary",
        },
        dietary: {
          progress: 57.14,
          prev: "interest",
          next: "character-creating",
        },
        "character-creating": {
          progress: 100,
          prev: "dietary",
          next: "character",
        },
      };

      let state = "gender";

      // 元件更新
      ratingFooterEl.addEventListener("click", (e) => {
        const nextBtn = e.target.closest('[data-action="next"]');
        const prevBtn = e.target.closest('[data-action="prev"]');

        // 沒點到 footer 內的目標就略過
        if (!ratingFooterEl.contains(e.target)) return;

        // 讀取 HTML data 狀態
        const nextData = ratingFooterEl.dataset.next || "";
        const prevData = ratingFooterEl.dataset.prev || "";

        if (nextBtn) {
          e.preventDefault();
          if (nextData === "character-creating") {
            ratingEl.dataset.progress = 100;
            const psychologicalTestContent = document.querySelector(
              "#psychological-test"
            );
            const mobileContainer = document.querySelector(".mobile-container");
            const characterCreatingContainer = document.querySelector(
              "#character-creating"
            );
            const characterCreatingContent = document.querySelector(
              "#character-creating .mobile-content"
            );

            mobileContainer.classList.add("halo-anmation");
            setTimeout(() => {
              psychologicalTestContent.classList.add("form-fade-out");
              characterCreatingContainer.classList.remove("d-none");
            }, 600);
            setTimeout(() => {
              mobileContainer.classList.add("content-full");
              characterCreatingContent.classList.remove("d-none");
              characterCreatingContent.classList.add("form-fade-in");
            }, 750);
            setTimeout(() => {
              window.location.href = `character.html`;
            }, 6200);
            return;
          } else {
            const formContent = document.querySelectorAll(`.${state}-content`);
            const nextContent = document.querySelectorAll(
              `.${nextData}-content`
            );
            state = nextData;
            formContent.forEach((r) => {
              r.classList.remove("form-fade-in");
              r.classList.add("form-fade-out");
            });
            setTimeout(() => {
              nextContent.forEach((r) => {
                r.classList.remove("form-fade-default", "form-fade-out");
                r.classList.add("form-fade-in");
              });
            }, 150);
          }
        }

        if (prevBtn) {
          e.preventDefault();
          if (prevData === "name") {
            window.location.href = `${prevData}.html`;
            return;
          } else {
            const formContent = document.querySelectorAll(`.${state}-content`);
            const prevContent = document.querySelectorAll(
              `.${prevData}-content`
            );
            state = prevData;
            formContent.forEach((r) => {
              r.classList.remove("form-fade-in");
              r.classList.add("form-fade-out");
            });
            setTimeout(() => {
              prevContent.forEach((r) => {
                r.classList.remove("form-fade-out");
                r.classList.add("form-fade-in");
              });
            }, 150);
          }
        }

        const { progress, prev, next } = stateMap[state];
        ratingEl.dataset.progress = progress;
        ratingFooterEl.dataset.prev = prev;
        ratingFooterEl.dataset.next = next;
        ratingFooterEl.dataset.isDisable = !!sessionStorage.getItem(state);
      });
    </script>
  </body>
</html>
