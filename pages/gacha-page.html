<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
  <link rel="stylesheet" href="../assets/scss/devices/devices.css">
</head>

<div class="device device-iphone-x ">

  <body class="position-relative   overflow-x-hidden">
    <div class="device-frame ">
      <%- include('./layout/gacha-page.ejs') %>
    </div>
    <div class="device-stripe "></div>
    <div class="device-header "></div>
    <div class="device-sensors  "></div>
    <div class="device-btns"></div>
    <div class="device-power"></div>
</div>



  <!-- Swiper -->
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <script>
    const swiper = new Swiper(".mySwiper", {
      slidesPerView: 2.04375,
      spaceBetween: 16,
      // (手機板排版設定)
    }); 
  </script>
  <script>
    const closeBtn = document.getElementById('close-btn');
    const filter = document.getElementById('filter');
    const meCard = document.querySelectorAll('.me-card');
    const info = document.getElementById('info');
    const hint = document.getElementById('hint');
    const likeBtn = document.getElementById('like-btn');
    const dislikeBtn = document.getElementById('dislike-btn');
    const cardList = document.getElementById('card-list');
    const nav = document.querySelector('.nav');
    const navItems = document.querySelectorAll('.nav-item');
    const navImgs = document.querySelectorAll('.nav-item-img');

    nav.addEventListener('click', function (e) {
      navImgs.forEach(el => el.className = el.className.replace("-on", "-off"));
      navItems.forEach(el => el.classList.remove("bg-callout", "rounded-pill"))

      const navItem = e.target.closest('.nav-item');
      if (!navItem) return;
      const navImg = navItem.querySelector(".nav-item-img")


      navImg.className = navImg.className.replace("-off", "-on")
      navItem.classList.add('bg-callout', 'rounded-pill');
    })



    meCard.forEach(el => {
      el.style.display = 'flex';
    })
    info.style.display = 'none';
    filter.style.display = 'flex';
    hint.style.display = 'flex';
    likeBtn.style.opacity = '0%';
    dislikeBtn.style.opacity = '0%';

    function closeHint() { //關掉提示
      filter.style.display = 'none';
      hint.style.display = 'none';
    }

    let startX, startY, deltaX, deltaY, currentX;

    cardList.addEventListener('touchstart', function (e) {
      const meCard = e.target.closest('.me-card');
      startX = e.touches[0].clientX;
      startY = e.touches[0].clientY;
    }, { passive: true });

    cardList.addEventListener('touchmove', function (e) {
      const meCard = e.target.closest('.me-card');
      currentX = e.touches[0].clientX;
      deltaX = currentX - startX;
      // 148 -193.84
      deltaX = Math.max(-193.84, Math.min(148, deltaX));
      const maxX = 148;
      const minX = -193.84;
      let opacityLike = deltaX / maxX;
      let opacityDlike = deltaX / minX;
      opacityLike = Math.max(0, Math.min(1, opacityLike));
      opacityDlike = Math.max(0, Math.min(1, opacityDlike));

      likeBtn.style.opacity = opacityLike;
      dislikeBtn.style.opacity = opacityDlike;

      deltaY = Math.min(8, Math.abs(deltaX) * 0.05405);
      // 跟著手指移動，讓卡片偏移 & 微旋轉

      meCard.style.transform = `translateX(${deltaX}px) translateY(${deltaY}px) rotate(${deltaX * 0.05405}deg)`;
      // 0.05
      ifMoving = false;
    }, { passive: true })

    cardList.addEventListener('touchend', function (e) {
      const meCard = e.target.closest('.me-card');

      //上滑開啟 下滑收合
      let endX = e.changedTouches[0].clientX;
      let endY = e.changedTouches[0].clientY;

      let diffX = endX - startX;
      let diffY = endY - startY;

      if (deltaX < 148 && deltaX > -193.84) {// 還原
        deltaX = 0;
        meCard.style.transform = `translateX(${deltaX}px) rotate(${deltaX * 0.05}deg)`;
        likeBtn.style.opacity = '0%';
        dislikeBtn.style.opacity = '0%';
      }

      if (deltaX === 148) location.href = "./match.html";
      if (deltaX === -193.84) {
        meCard.style.display = 'none';
        dislikeBtn.style.opacity = '0%';
      }

      if (Math.abs(diffX) <= 10) {
        if (diffY > 0) {
          info.style.display = "none";  //下滑收合
        } else {
          info.style.display = "block"; //上滑開啟
        }
      }
    }, { passive: true });







  </script>

  <script type="module" src="../main.js"></script>


  </body>

</html>